import { makeFetch } from '../client/fetch.js';
import { createSafeJsonRpcClient } from '../client/safe_json_rpc_client.js';
import { createSafeJsonRpcServer, startHttpRpcServer } from '../server/safe_json_rpc_server.js';
export async function createJsonRpcTestSetup(handler, schema, serverOptions = {}, clientOptions = {}) {
    const server = createSafeJsonRpcServer(handler, schema, serverOptions);
    const httpServer = await startHttpRpcServer(server, {
        host: '127.0.0.1'
    });
    const noRetryFetch = makeFetch([], true);
    const url = `http://127.0.0.1:${httpServer.port}`;
    const client = createSafeJsonRpcClient(url, schema, {
        fetch: noRetryFetch,
        ...clientOptions
    });
    return {
        server,
        client,
        httpServer,
        url
    };
}
